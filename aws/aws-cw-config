
########## CW config for lunux instances(ubuntu) #########

INSTANCE_ID=$(ec2metadata --instance-id)
aws ec2 create-tags --resources $INSTANCE_ID --tags Key=Node_Type,Value=node_manager
aws ec2 monitor-instances --instance-ids $INSTANCE_ID 
sudo aws s3 cp s3://$LOGS_S3_BUCKET/config.json /opt/aws/amazon-cloudwatch-agent/bin/
sudo sed -i 's/{instance_id}/node_manager_{instance_id}/g' /opt/aws/amazon-cloudwatch-agent/bin/config.json    
sudo systemctl enable amazon-cloudwatch-agent.service
sudo /opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-ctl -a fetch-config -m ec2 -s -c file:/opt/aws/amazon-cloudwatch-agent/bin/config.json
sudo /opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-ctl -m ec2 -a status
